name: PR Checks

on:
  pull_request:
    branches: [main, master, develop]

jobs:
  commitlint:
    name: Commitlint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      - name: Validate commits
        run: npx commitlint --from ${{ github.event.pull_request.base.sha }} --to ${{ github.event.pull_request.head.sha }} --verbose

  branch-naming:
    name: Branch Name Check
    runs-on: ubuntu-latest
    steps:
      - name: Validate branch name
        run: |
          branch="${{ github.head_ref }}"
          types="feat|fix|docs|style|refactor|perf|test|chore|ci|build|revert|hotfix"
          scopes="deps|config|ui|backend|frontend|docs|build|ci|tests|release"
          pattern="^($types)/($scopes)/[a-z0-9-]+$|^($types)/[a-z0-9-]+$"

          if ! echo "$branch" | grep -qE "$pattern"; then
            echo "❌ Branch name '$branch' doesn't match the required pattern."
            echo ""
            echo "Valid formats:"
            echo "  type/scope/description  →  feat/ui/add-button"
            echo "  type/description        →  fix/auth-bug"
            echo ""
            echo "Types:  $types"
            echo "Scopes: $scopes (optional)"
            exit 1
          fi
          echo "✓ Branch name '$branch' is valid"
